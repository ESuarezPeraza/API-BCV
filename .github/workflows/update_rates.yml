name: Actualizar Tasa BCV

on:
  # 1. Permite ejecutarlo manualmente desde la pestaña "Actions"
  workflow_dispatch:

  # 2. Lo programa para ejecutarse todos los días
  schedule:
    # 5:00 PM (17:00) VET = 21:00 UTC
    - cron: '0 21 * * *'

jobs:
  scrape_and_commit:
    runs-on: ubuntu-latest # Se ejecuta en un servidor Linux limpio

    steps:
      # 1. Descarga tu código (scraper.py, historial_bcv.csv, etc.)
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      # 2. Configura el entorno de Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Usamos la misma versión de nuestro Dockerfile

      # 3. Instala las dependencias
      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. ¡LA EJECUCIÓN!
      # Aquí es donde se ejecuta el scraper en la red limpia de GitHub
      - name: Ejecutar el Scraper del BCV
        run: python scraper.py

      # 5. Guarda los cambios
      # Esta acción especial revisa si 'historial_bcv.csv' cambió.
      # Si cambió, crea un nuevo commit y lo sube al repositorio.
      - name: Hacer Commit de la nueva tasa
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Actualización automática de tasa BCV"
          file_pattern: historial_bcv.csv
          # Opcional: define el autor del commit
          commit_user_name: Bot Scraper BCV
          commit_user_email: bot@github.actions.com